---
title: 'Negativas de acesso a informação no governo Federal'
subtitle: 'Órgãos e entidades do poder Executivo - janeiro de 2015 até 2021'
output:
  html_document:
    code_folding: hide
    toc: true
    toc_depth: 4
    theme: paper
    toc_float:
      collapsed: false
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  collapse = T,
  comment = "#>",
  message = F,
  warning = F,
  fig.align = "left",
  echo = T
)
```

```{r}
library(tidyverse)
library(lubridate)
library(glue)
library(here)
library(ggtext)
library(patchwork)

set.seed(1014)

knitr::knit_hooks$set(inline = function(x) prettyNum(x, big.mark = ".", decimal.mark = ","))

options(digits = 1,
        scipen = 999,
        OutDec = ",",
        knitr.kable.NA = '')

Sys.setenv(LANGUAGE = "pt-br")
Sys.setlocale("LC_TIME", "pt_BR")

# aplica identidade visual da TB/AeP
aep_colors <- c(
  
  laranja = "#F9A521",
  rosa = "#D81755",
  cinza = "#969696",
  marrom = "#B27D5C"
  
)

paleta_governo = c(
  
  `Dilma II` = aep_colors[["laranja"]],
  `Temer` = aep_colors[["cinza"]],
  `Bolsonaro` = aep_colors[["rosa"]]  
  
)

tb_colors <- c(
  
  laranja = "#F6A323",
  cinza_escuro = "#1d1d1b",
  cinza_claro =  "#6f7171",
  cinza_quase_branco = "#ececec",
  azul = "#41ACBD"
  
  )
```

```{r echo = FALSE}
periodo_final <- "2021-07-01"

pedidos_cgu <- readRDS(here("dados/load/rds/pedidos-clean.rds")) %>%
  filter(data_registro <= periodo_final,
         data_resposta <= periodo_final)

recursos_cgu <- readRDS(here("dados/load/rds/recursos-clean.rds")) %>%
  filter(data_registro <= periodo_final,
         data_resposta <= periodo_final)


# respostas total por governo --------------------------------------------------
# aux <- respostas_comuns %>% 
#   group_by(governo_que_respondeu) %>%
#   summarise(qt = sum(qt), .groups = "drop") %>% 
#   ungroup()

# finaliza rcom taxa de tipo/total de respostas --------------------------------
# respostas_comuns_gov <- respostas_comuns %>% 
#   group_by(governo_que_respondeu, decisao) %>%
#   summarise(qt = sum(qt), .groups = "drop") %>% 
#   left_join(aux, by = "governo_que_respondeu", suffix = c("_tipo_resposta", "_respostas_total")) %>%
#   mutate(perc = qt_tipo_resposta / qt_respostas_total)

```

O objetivo deste relatório é apresentar uma avaliação a respeito das negativas de acesso aos pedidos de informação feitos para os órgãos e entidades do poder Executivo federal via [LAI][site_lai] e registrados no [portal da Acesso a Informação do Governo Federal][site_consultaesic]. 

As negativas de acesso a informação foram analisadas considerando as classificações de atendimento que os próprios órgãos do Governo Federal atribuem aos pedidos de informação que recebem. As classificações de pedidos de informação utilizadas pelo Governo Federal são:

 * Acesso concedido: fornecimento da informação demandada.
 * Acesso parcialmente concedido: fornecimento de parte da informação demandada e negativa ou não atendimento de parte do pedido.
 * Acesso negado: negativa de fornecimento da informação demandada.
 * Informação inexistente.
 * Não se trata de solicitação de informação.
 * Órgão não tem competência para responder sobre o assunto.
 * Pergunta Duplicada/Repetida.

Além das classificações de atendimento, a Controladoria Geral da União atribui uma especificação que justifica a decisão sobre o pedido de informação encaminhado aos órgãos do Executivo. Neste relatório, foram consideradas somente as especificações atribuídas aos pedidos com acesso negado (tabela completa em anexo), sendo elas:

 * Pedido incompreensível
 * Processo decisório em curso
 * Informação sigilosa classificada conforme a Lei 12.527/2011
 * Informação sigilosa de acordo com legislação específica
 * Pedido exige tratamento adicional de dados
 * Dados pessoais
 * Pedido desproporcional ou desarrazoado
 * Pedido genérico

A análise cobre o período de 01/01/2015 até 31/05/2021, abrangendo o final do segundo mandato de Dilma Rousseff (até meados de maio de 2016), todo o mandato de Michel Temer (de meados de maio de 2016 até dezembro de 2018) e o mandato de Jair Bolsonaro (de janeiro de 2019 até maio de 2021). Especificamente, foram analisados os seguintes aspectos:

 * A frequência total de pedidos de acesso a informação e a proporção de respostas atendidas (classificadas como "acesso concedido") ano a ano, categorizando o período analisado por governo.
 * A frequência das classificações de atendimento atribuídas pelos órgãos, categorizadas por governo.
 * A prevalência de termos considerados controversos no texto das respostas de “Acesso negado”, a saber: “Trabalho adicional”, “Fishing”, “Desproporcional”, “Desarrazoado”, “Dados sigilosos”, “Dados pessoais”, “Pedido genérico”, “Processo decisório em curso” e “Segurança Nacional” e "Lei Geral de Proteção de Dados"
 * A evolução das negativas de pedidos de acesso a informação no contexto da nova [Lei Geral de Proteção de Dados][site_lgpd].
 
É importante ressaltar que este relatório não considera possíveis distorções que as classificações supracitadas estão sujeitas no que tange ao mérito da resposta fornecida pelos órgãos do Executivo federal. Em [estudos anteriores][relatorio_tb], foram detectadas inconsistências entre a classificação da resposta atribuída por um órgão e a real qualidade dessa resposta em relação ao que foi objetivamente solicitado pelo requerente do pedido, demonstrando casos onde o órgão considerou o acesso concedido quando a real resposta ao pedido foi uma negativa.

Os dados de utilizados neste relatório foram coletados do [e-sic do Governo Federal](http://www.consultaesic.cgu.gov.br/busca/_layouts/15/DownloadPedidos/DownloadDados.aspx). A coleta, tratamento e análise dos dados está documentada para fins de reproducibilidade no [GitHub da Transparência Brasil](https://github.com/Transparencia-Brasil/negativas-acesso-informacao-Executivo-federal-2021-1).

#### Pedidos de acesso a informação - quantidades de registros mês a mês

```{r}
pedidos_por_mes <- pedidos_cgu %>% 
  group_by(data_registro, governo_que_registrou) %>%
  summarise(qt = n(), .groups = "drop")

pedidos_por_mes %>% 
  ggplot() +
  geom_bar(
    aes(x = data_registro, y = qt, fill = governo_que_registrou, color = governo_que_registrou),
    stat = "identity", 
    alpha = .5
  ) +
  theme_minimal() +
  scale_fill_manual(values = paleta_governo) +
  scale_color_manual(values = paleta_governo) +
  scale_x_date(breaks = scales::date_breaks("3 months"), date_labels = "%m-%y", expand = c(0, 0)) +
  labs(
    y = "Quantidade",
    x = NULL,
    fill = NULL,
    title = NULL,
    subtitle = NULL
  ) +
  theme(
    axis.text.x = element_text(hjust = .5, vjust = .5, angle = 90),
    legend.position = c(.1, .9),
    panel.grid.minor = element_blank(),
    legend.background = element_rect(fill = alpha(aep_colors[["cinza"]], .2), color = aep_colors[["cinza"]])
  ) +
  guides(color = "none")
```

O índice de acessos concedidos aos pedidos de informação é o percentual de pedidos em que o Governo Federal concede acesso ao requerente em relação ao total de pedidos registrados no [e-sic do Governo Federal][site_consultaesic]. Além de "acesso concedido", o Governo Federal classifica as respostas aos pedidos de informação via LAI como *"Não se trata de solicitação de informação"*, *"Acesso negado"*, *"Acesso parcialmente concedido"*, *"Informação inexistente"*, *"Órgão não tem competência para responder sobre o assunto"*, *"Pergunta duplicada/repetida"*.

#### Atendimento da LAI ano a ano - 2015 a 2021

```{r}
pedidos_por_ano <- pedidos_cgu %>% 
  select(data_registro, id_pedido) %>% 
  mutate(data_registro = floor_date(data_registro, unit = "year")) %>% 
  group_by(data_registro) %>% 
  summarise(qt = n() / 1e3, .groups = "drop") %>% 
  mutate(ano = ordered(year(data_registro)), categoria = "Total")

pedidos_por_ano_concedidos <- pedidos_cgu %>% 
  filter(decisao == "Acesso Concedido") %>%
  select(data_registro, id_pedido) %>%
  mutate(data_registro = floor_date(data_registro, unit = "year")) %>%
  group_by(data_registro) %>%
  summarise(qt = n() / 1e3, .groups = "drop") %>% 
  mutate(ano = ordered(year(data_registro)), categoria = "Acesso Concedido")

indice_respostas_concedidas <- pedidos_por_ano %>%
  left_join(
    pedidos_por_ano_concedidos, 
    by = "data_registro",
    suffix = c("_pedidos", "_concedidos")
  ) %>%
  mutate(indice_acessos_concedidos = qt_concedidos / qt_pedidos)
```

```{r}
pedidos_por_ano %>% 
  bind_rows(pedidos_por_ano_concedidos) %>% 
  ggplot(aes(x = data_registro, y = qt, fill = categoria, color = categoria)) +
  geom_point(size = 14, alpha = .3, shape = 21) +
  geom_line(size = 1.5, alpha = .6) +
  geom_text(aes(label = round(qt, 1)), color = "black") +
  labs(x = NULL, y = "Quantidade (mil)", fill = NULL, color = NULL) +
  theme_minimal() + 
  scale_color_manual(values = c(aep_colors[["rosa"]], aep_colors[["cinza"]])) +
  scale_fill_manual(values = c(aep_colors[["rosa"]], aep_colors[["cinza"]])) +
  scale_x_date(date_breaks = "1 year", date_labels = "%Y") +
  theme(
    legend.position = "top",
    legend.justification = "left",
    legend.direction = "horizontal",
    panel.grid.minor.x = element_blank()
  )
```

> Em 2021 o Governo Federal contabilizou `r pedidos_por_ano$qt[7]` mil pedidos de informação, concedendo o acesso para `r pedidos_por_ano_concedidos$qt[7]` mil deles (`r scales::percent(indice_respostas_concedidas[[7, 8]])`).

#### Índice de acessos concedidos

```{r}
indice_respostas_concedidas %>%
  ggplot() +
  geom_bar(aes(
    x = data_registro,
    y = indice_acessos_concedidos),
    fill = tb_colors[["laranja"]],
    stat = "identity",
    alpha = .7,
    color = "black"
  ) +
  geom_text(aes(
    x = data_registro,
    y = indice_acessos_concedidos, 
    label = scales::percent(indice_acessos_concedidos, accuracy = 0.1, decimal.mark = ",")),
    vjust = -1
  ) +
  scale_y_continuous(labels = scales::percent_format(), limits = c(0, .75)) +
  labs(
    x = NULL,
    y = NULL,
    title = NULL
  ) +
  theme_minimal() +
  theme(
    panel.grid.minor = element_blank(),
    panel.grid.major.x = element_blank(),
    axis.text.x = element_text(vjust = 7)
  )
```

#### Decisão das solicitações mês a mês (linhas, esquerda) e % anual (barras, direita)

```{r fig.height=15, fig.width=10}
# cores de fundo ---------------------------------------------------------------
rect_gov <- tibble(
  governo_que_respondeu = c("Dilma II", "Temer", "Bolsonaro"),
  xmin = c("2015-01-01", "2016-05-01", "2019-01-01"), # inicio de cada governo
  xmax = lead(xmin, default = periodo_final),         # fim de cada governo
  ymin = -Inf,
  ymax = Inf
) %>% mutate(across(xmin:xmax, ~ as_date(ymd(.x))))

# tipo respostas mais comuns histórico -----------------------------------------
decisao <- pedidos_cgu %>%
  group_by(data_resposta, decisao, governo_que_respondeu) %>%
  summarise(qt = n(), .groups = "drop") %>%
  mutate(
    decisao = case_when(
      decisao == "Órgão não tem competência para responder sobre o assunto" ~
        "Órgão não tem competência \npara responder sobre o assunto",
      TRUE ~ decisao
      ) %>% fct_reorder(qt, .desc = T)
    )

# plot esquerdo ----------------------------------------------------------------
p1 <- decisao %>%
  ggplot() +
  geom_line(aes(x = data_resposta, y = qt), show.legend = F) +
  geom_vline(xintercept = ymd(c("2016-05-01", "2019-01-01")), lty = 3) +
  geom_rect(
    data = rect_gov,
    aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax, fill = governo_que_respondeu), 
    alpha = .2, show.legend = F
  ) +
  scale_fill_manual(values = paleta_governo) +
  scale_color_manual(values = paleta_governo) +
  theme_minimal() +
  theme(
    legend.position = "top",
    legend.text = element_text(size = 8),
    axis.text.x = element_text(hjust = .5, vjust = .5, angle = 90),
    panel.grid.minor = element_blank(),
    strip.text = element_text(angle = 0, hjust = 0)
  ) +
  scale_x_date(breaks = scales::date_breaks("3 months"), date_labels = "%m-%y", expand = c(0, 0)) +
  labs(
    x = NULL,
    y = NULL,
    subtitle = "Em milhares - mês a mês",
    color = NULL,
    fill = NULL
  ) +
  facet_wrap(~ reorder(decisao, -qt), scales = 'free', ncol = 1)

# plot direito -----------------------------------------------------------------
p2 <- decisao %>% 
  group_by(ano = year(data_resposta), decisao) %>% 
  summarise(qt = sum(qt), .groups = "drop") %>% 
  group_by(ano) %>% 
  mutate(qt_ano = sum(qt),
         perc_ano = qt / qt_ano) %>% 
  ungroup() %>% 
  arrange(decisao, ano) %>% 
  ggplot(aes(x = perc_ano, y = reorder(ano, -ano))) +
  facet_wrap(~ reorder(decisao, -perc_ano), ncol = 1, scales = "free_x") +
  geom_col(aes(x = 1), fill = tb_colors[["cinza_quase_branco"]], color = "white") +
  geom_col(alpha = .6, fill = tb_colors["azul"], color = tb_colors["azul"]) +
  geom_text(aes(label = scales::percent(perc_ano, accuracy = 0.1, decimal.mark = ",")),
             size = 2.8, hjust = -.1, check_overlap = T) +
  theme_minimal() +
  scale_y_discrete(expand = c(0, 0)) +
  scale_x_continuous(expand = c(0, 0), labels = scales::percent_format(), limits = c(0,1),
                     breaks = c(0,.3, .6, .9)) +
  theme(
    plot.subtitle = element_text(),
    panel.grid.major.y = element_line(color = "white"),
    panel.grid.major.x = element_blank(),
    panel.grid.minor.y = element_line(color = "white"),
    panel.background = element_blank(),#rect(fill = tb_colors[["cinza_quase_branco"]], color = "transparent"), 
    strip.text = element_text(hjust = 0, vjust = 0, color = "white"),
    axis.text.x = element_text(hjust = 0, vjust = 0, size = 7)
  ) +
  labs(
    x = "",
    y = NULL,
    fill = NULL,
    subtitle = "% respostas por ano*"
  )

comb <- p1 + p2 & theme(legend.position = "none")
comb + plot_layout(widths = c(2.7, 1))
```

### Especificação da decisão

```{r}
decisao_por_ano_especificada <- pedidos_cgu %>% 
  transmute(
    ano = year(data_resposta),
    id_pedido,
    decisao,
    especificacao_decisao = replace_na(especificacao_decisao, "Sem especificação (campo não preenchido)"),
    decisao = case_when(
      decisao == "Acesso Concedido" ~ decisao,
      decisao == "Acesso Negado" ~ decisao,
      decisao == "Acesso Parcialmente Concedido" ~ decisao,
      TRUE ~ "Acesso Não Concedido - Outro Motivo*"
    )
  ) %>% 
  count(ano, decisao, especificacao_decisao) %>% 
  group_by(ano) %>% 
  mutate(n_ano = sum(n)) %>% 
  ungroup() %>% 
  group_by(ano, decisao) %>% 
  mutate(n_ano_decisao = sum(n)) %>% 
  ungroup() %>% 
  mutate(perc_ano = n / n_ano)
```

```{r}
plot_decisao_por_ano_especificada <- function(df, decisao_acesso) {
  df %>% 
    filter(decisao == decisao_acesso) %>% 
    ggplot(aes(x = ano, y = perc_ano, fill = str_wrap(especificacao_decisao, 30))) +
    geom_area(show.legend = F, alpha = .5) +
    geom_point(show.legend = F) +
    theme_minimal() +
    scale_y_continuous(labels = scales::percent) +
    facet_wrap(. ~ reorder(str_wrap(especificacao_decisao, 70), -perc_ano, sum),
               scales = "free_x", ncol = 2) +
    scale_x_continuous(breaks = 2015:2021, labels = 2015:2021) +
    theme(strip.text = element_text(hjust = 0, face = "bold")) +
    labs(y = "% do total de pedidos", x = NULL, fill = NULL)
}
```

</br></br>

#### Acesso concedido

```{r fig.height=8}
plot_decisao_por_ano_especificada(decisao_por_ano_especificada, "Acesso Concedido")
```

</br></br>

#### Acesso Negado

```{r fig.height=8}
plot_decisao_por_ano_especificada(decisao_por_ano_especificada, "Acesso Negado")
```

</br></br>

#### Acesso parcialmente concedido

```{r fig.height=8}
plot_decisao_por_ano_especificada(decisao_por_ano_especificada, "Acesso Parcialmente Concedido")
```

</br></br>

#### Acesso não concedido - outros motivos

> * Informação inexistente, não se trata de solicitação de informação, órgão não tem competência para responder sobre o assunto, pergunta duplicada/repetida

```{r}
plot_decisao_por_ano_especificada(decisao_por_ano_especificada, "Acesso Não Concedido - Outro Motivo*")
```

[site_lai]: http://www.planalto.gov.br/ccivil_03/_ato2011-2014/2011/lei/l12527.htm
[site_consultaesic]: http://www.consultaesic.cgu.gov.br/busca/SitePages/Principal.aspx
[site_lgpd]: http://www.planalto.gov.br/ccivil_03/_ato2015-2018/2018/lei/l13709.htm
[relatorio_tb]: https://www.transparencia.org.br/downloads/publicacoes/Alteracoes_atendimento_pedidos_de_informacao_e_MP_928.pdf